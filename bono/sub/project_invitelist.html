<!DOCTYPE html>
<html>
    <head>
      <style>
      .selected {
        background-color: gray;
      }
      </style>
        <script src="//code.jquery.com/jquery-1.10.2.js"></script>
        <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
        <script>
          var list_item
            = $("<li>")
            .append("<p class='pname'>")
            .append("<p class='pdesc'>")
            .append("<p class='pmember'>")
            .append("<p class='pdate'>")
            .append("<p class='powner'>");

          var main = function() {

            /*****************
             SOCKET.IO
            *******************/
            var invitelist = io.connect('http://localhost:8000/project_invitelist').on('connect', function(){
              console.log('connected');
            });

            // 프로젝트 정보 받아서 화면 갱신
            invitelist.on('invitelist_response', function(json){

              // 리스트 비우기
              $('#project_invitelist_list').empty();

              var arr = JSON.parse(json);

              if (arr.length == 0)
              {
                alert("프로젝트 정보를 가져오는데 실패했습니다.");
              }
              else
              {
                for (var i=0; i<arr.length; i++)
                {
                  console.log(arr[i]);
                  var li = list_item;
                  li.children(".pname").html(arr[i].name);
                  li.children(".pdesc").html(arr[i].desc);
                  li.children(".pmember").html(arr[i].member);
                  li.children(".pdate").html(arr[i].date);
                  li.children(".powner").html(arr[i].owner);

                  $('#project_invitelist_list').append(li);
                }
              }
            });

            invitelist.on('invitelist_accept_response', function(json){

              var result = JSON.parse(json);

              if (result.msg == "successful")
              {
                alert("프로젝트초대 수락 성공");
                alert(result.reason)
              }
              else
              {
                alert("프로젝트초대 수락 실패");
                alert(result.reason)
              }
            });

            invitelist.on('invitelist_decline_response', function(json){

              var result = JSON.parse(json);

              if (result.msg == "successful")
              {
                alert("프로젝트초대 거절 성공");
                alert(result.reason)
              }
              else
              {
                alert("프로젝트초대 거절 실패");
                alert(result.reason)
              }
            });

          /************************
           EVENT HANDLERS
           ************************/
           // 리스트 선택
           $('li').click(function(){
             $('li').removeClass('selected');
             $(this).addClass('selected');
           });

           // 초대리스트 요청
           $('#btn_request').click(function(){

             var user_id = $('#user_id');

             if (user_id != "")
               invitelist.emit("invitelist_request", user_id);
           });

           // 초대 수락
           $('#btn_accept').click(function(){

             var user_id = $('#user_id');
             var project_name = $('.selected').children('.pname').val();

             if (user_id != "" && project_name != "")
               create.emit('invitelist_accept', JSON.stringify({id: user_id, project : project_name}));
           });

           // 초대 거절
           $('#btn_decline').click(function(){

             var user_id = $('#user_id');
             var project_name = $('.selected').children('.pname').val();

             if (user_id != "" && project_name != "")
               create.emit('invitelist_decline', JSON.stringify({id: user_id, project : project_name}));
           });
        };

        $(document).ready(main);
      </script>
    </head>
    <body>
        <div id="project_invitelist_form">
            <ul id="project_invitelist_list">
            </ul>
            <div class="project_invitelist_forms">
                <input type="text" placeholder="User ID" id="user_id"/>
            </div>
            <div class="project_invitelist_forms">
                <input type="button" value="Show all invites" id="btn_request"/>
            </div>
            <div class="project_invitelist_forms">
                <input type="button" value="Accept" id="btn_accept"/>
            </div>
            <div class="project_invitelist_forms">
                <input type="button" value="Decline" id="btn_decline"/>
            </div>
        </div>
    </body>
</html>
