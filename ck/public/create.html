<!doctype html>
<html>
    <head>
        <link rel="stylesheet" href="./css/bono.css" />
        <link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
        <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
        <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
        <script>
            var u_name = 'positoy';
            var p_name, p_desc;

            var main = function() {
                var create = io.connect('http://127.0.0.1:3000/create');

                // 아이디 전송
                create.on('connect', function(){
                    console.log('connected');
                });
            
                $('.btn-create').click(function(){
                    
                    p_name = $('#name').val();
                    p_desc = $('#desc').val();
                    
                    if (p_name.trim() == "" || p_desc.trim() == "")
                    {
                        return false;
                    }
                    else
                    {
                        var o = { user: u_name, project : { name: p_name, description: p_desc } };
                        var j = JSON.stringify(o);
                        console.log(json);
//                        create.emit('create_request', j);
                    }
                });

                // 프로젝트 정보 받아서 화면 갱신
                create.on('create_response', function(msg){
                    
                    if (msg == 'failure')
                    {
                        console.log('동일한 이름의 프로젝트가 존재합니다.');
                    }
                    else if (msg == 'success')
                    {
                        // 사용자 이름 구해야함.
                        // view 화면으로 이동
                        var url = "http://127.0.0.1/load.html?";
                        url = url + "user=" + u_name + "&project=" + p_name;
                        window.location.reload(url);
                    }
                });

                $('.btn-cancel').click(function(){
                    window.location.replace("http://127.0.0.1:3000/view.html");
                });
            }

            $(document).ready(main);
        </script>
    </head>
    <body>
        <div id="create">
            <div class="project">
                <form action="create" method="post">
                    <ul>
                        <li>project name<br/>
                        <input type="text" id="name" name="name"/></li>

                        <li>description<br/>
                        <textarea id="desc" name="desc"></textarea></li>
                    </ul>
                    <button class="btn-create">create</button>
                    <button class="btn-cancel">cancel</button>
                </form>
                </div>
            </div>
    </body>
</html>
